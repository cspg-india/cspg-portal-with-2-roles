<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug & Test - CSPG Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #555;
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        
        .info-box {
            background: #e7f3ff;
            border: 1px solid #007bff;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .success-box {
            background: #d4edda;
            border: 1px solid #28a745;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            color: #155724;
        }
        
        .error-box {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            color: #721c24;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        button.danger:hover {
            background: #c82333;
        }
        
        button.success {
            background: #28a745;
        }
        
        button.success:hover {
            background: #218838;
        }
        
        pre {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            margin-bottom: 15px;
        }
        
        .status-line {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .status-line.success {
            background: #d4edda;
            color: #155724;
            border-left: 3px solid #28a745;
        }
        
        .status-line.error {
            background: #f8d7da;
            color: #721c24;
            border-left: 3px solid #dc3545;
        }
        
        .status-line.info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 3px solid #17a2b8;
        }
        
        #output {
            margin-top: 20px;
        }
        
        .stat-item {
            display: inline-block;
            margin-right: 20px;
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug & Test Panel - CSPG Portal</h1>
        
        <div class="info-box">
            ‚ÑπÔ∏è <strong>Note:</strong> Use this panel to test the application functionality and debug issues.
        </div>
        
        <!-- Storage Information -->
        <div class="section">
            <h2>üìä Storage Information</h2>
            <button onclick="checkStorage()">Check Storage Status</button>
            <button onclick="clearAllStorage()" class="danger">Clear All Storage</button>
            <div id="storageOutput" style="margin-top: 15px;"></div>
        </div>
        
        <!-- User Information -->
        <div class="section">
            <h2>üë§ User Information</h2>
            <button onclick="showSession()">Show Current Session</button>
            <button onclick="showAllUsers()">Show All Users</button>
            <button onclick="logoutUser()" class="danger">Logout User</button>
            <div id="userOutput" style="margin-top: 15px;"></div>
        </div>
        
        <!-- Submissions Information -->
        <div class="section">
            <h2>üìÑ Submissions Information</h2>
            <button onclick="showSubmissions()">Show All Submissions</button>
            <button onclick="showUserSubmissions()">Show My Submissions</button>
            <button onclick="createTestSubmission()" class="success">Create Test Submission</button>
            <button onclick="deleteAllSubmissions()" class="danger">Delete All Submissions</button>
            <div id="submissionOutput" style="margin-top: 15px;"></div>
        </div>
        
        <!-- Test Signup/Login -->
        <div class="section">
            <h2>üß™ Test Signup & Login</h2>
            <button onclick="testSignup()">Create Test User</button>
            <button onclick="testLogin()">Login as Test User</button>
            <button onclick="checkAuth()">Check Authentication</button>
            <div id="testOutput" style="margin-top: 15px;"></div>
        </div>
        
        <!-- Dashboard Rendering -->
        <div class="section">
            <h2>üñ•Ô∏è Dashboard Rendering</h2>
            <button onclick="testDashboardRender()">Render Dashboard</button>
            <button onclick="testRefreshDashboard()">Refresh Dashboard</button>
            <div id="dashboardOutput" style="margin-top: 15px;"></div>
        </div>
        
        <!-- Console Logs -->
        <div class="section">
            <h2>üìù Console Commands</h2>
            <p>Copy and paste these commands in the browser console (F12):</p>
            <pre>// View current session
JSON.parse(localStorage.getItem('cspg_session'))

// View all users
JSON.parse(localStorage.getItem('cspg_users'))

// View all submissions
JSON.parse(localStorage.getItem('cspg_submissions'))

// Check submission by user ID
var session = JSON.parse(localStorage.getItem('cspg_session'));
var subs = JSON.parse(localStorage.getItem('cspg_submissions'));
subs.filter(s => s.userId === session.userId)

// Count submissions for current user
var session = JSON.parse(localStorage.getItem('cspg_session'));
var subs = JSON.parse(localStorage.getItem('cspg_submissions'));
subs.filter(s => s.userId === session.userId).length

// Clear all storage
localStorage.clear()</pre>
        </div>
    </div>
    
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/submission.js"></script>
    
    <script>
        'use strict';
        
        function addOutput(elementId, message, type = 'info') {
            const output = document.getElementById(elementId);
            const line = document.createElement('div');
            line.className = 'status-line ' + type;
            line.textContent = message;
            output.appendChild(line);
        }
        
        function clearOutput(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }
        
        async function checkStorage() {
            clearOutput('storageOutput');
            
            const users = JSON.parse(localStorage.getItem('cspg_users') || '[]');
            const submissions = JSON.parse(localStorage.getItem('cspg_submissions') || '[]');
            const session = JSON.parse(localStorage.getItem('cspg_session'));
            
            addOutput('storageOutput', `‚úÖ Total Users: ${users.length}`, 'success');
            addOutput('storageOutput', `‚úÖ Total Submissions: ${submissions.length}`, 'success');
            addOutput('storageOutput', `${session ? '‚úÖ Session Active' : '‚ùå No Session'}`, session ? 'success' : 'error');
            
            const usedSpace = JSON.stringify(localStorage).length;
            addOutput('storageOutput', `üìä Storage Used: ${(usedSpace / 1024).toFixed(2)} KB`, 'info');
        }
        
        function showSession() {
            clearOutput('userOutput');
            const session = Storage.getSession();
            
            if (!session) {
                addOutput('userOutput', '‚ùå No active session', 'error');
                return;
            }
            
            addOutput('userOutput', `‚úÖ Session Found:`, 'success');
            const output = document.getElementById('userOutput');
            const pre = document.createElement('pre');
            pre.textContent = JSON.stringify(session, null, 2);
            output.appendChild(pre);
        }
        
        function showAllUsers() {
            clearOutput('userOutput');
            const users = Storage.getUsers();
            
            if (users.length === 0) {
                addOutput('userOutput', '‚ùå No users found', 'error');
                return;
            }
            
            addOutput('userOutput', `‚úÖ Found ${users.length} user(s):`, 'success');
            const output = document.getElementById('userOutput');
            users.forEach((user, index) => {
                const pre = document.createElement('pre');
                pre.textContent = `User ${index + 1}:\n${JSON.stringify(user, null, 2)}`;
                output.appendChild(pre);
            });
        }
        
        async function testSignup() {
            clearOutput('testOutput');
            addOutput('testOutput', 'Creating test user...', 'info');
            
            try {
                const userData = {
                    firstName: 'Test',
                    lastName: 'User',
                    email: 'test' + Date.now() + '@example.com',
                    institution: 'Test University',
                    department: 'Computer Science',
                    position: 'Professor',
                    password: 'Test@123456',
                    confirmPassword: 'Test@123456'
                };
                
                await Auth.register(userData);
                addOutput('testOutput', `‚úÖ User created successfully!`, 'success');
                addOutput('testOutput', `Email: ${userData.email}`, 'info');
                addOutput('testOutput', `Password: ${userData.password}`, 'info');
                checkStorage();
            } catch (error) {
                addOutput('testOutput', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function testLogin() {
            clearOutput('testOutput');
            const users = Storage.getUsers();
            
            if (users.length === 0) {
                addOutput('testOutput', '‚ùå No users available. Create a test user first!', 'error');
                return;
            }
            
            const testUser = users[0];
            addOutput('testOutput', `Logging in as: ${testUser.email}`, 'info');
            
            try {
                await Auth.login(testUser.email, 'Test@123456');
                addOutput('testOutput', `‚úÖ Login successful!`, 'success');
                showSession();
            } catch (error) {
                addOutput('testOutput', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function checkAuth() {
            clearOutput('testOutput');
            const isAuth = Auth.isAuthenticated();
            const currentUser = Auth.getCurrentUser();
            
            if (isAuth && currentUser) {
                addOutput('testOutput', `‚úÖ User is authenticated`, 'success');
                addOutput('testOutput', `User: ${currentUser.fullName}`, 'info');
            } else {
                addOutput('testOutput', `‚ùå User is not authenticated`, 'error');
            }
        }
        
        function logoutUser() {
            Storage.clearSession();
            clearOutput('userOutput');
            addOutput('userOutput', `‚úÖ User logged out`, 'success');
        }
        
        function showSubmissions() {
            clearOutput('submissionOutput');
            const submissions = Storage.getSubmissions();
            
            if (submissions.length === 0) {
                addOutput('submissionOutput', '‚ùå No submissions found', 'error');
                return;
            }
            
            addOutput('submissionOutput', `‚úÖ Found ${submissions.length} submission(s):`, 'success');
            const output = document.getElementById('submissionOutput');
            submissions.forEach((sub, index) => {
                const pre = document.createElement('pre');
                pre.textContent = `Submission ${index + 1} (ID: ${sub.id}):\nUser ID: ${sub.userId}\nTitle: ${sub.title}\nFile: ${sub.fileName}\nDate: ${sub.dateSubmitted}`;
                output.appendChild(pre);
            });
        }
        
        function showUserSubmissions() {
            clearOutput('submissionOutput');
            const session = Storage.getSession();
            
            if (!session) {
                addOutput('submissionOutput', '‚ùå No active session', 'error');
                return;
            }
            
            const userSubs = Storage.getUserSubmissions(session.userId);
            
            if (userSubs.length === 0) {
                addOutput('submissionOutput', `‚úÖ User has 0 submissions`, 'info');
                return;
            }
            
            addOutput('submissionOutput', `‚úÖ User has ${userSubs.length} submission(s):`, 'success');
            const output = document.getElementById('submissionOutput');
            userSubs.forEach((sub, index) => {
                const p = document.createElement('p');
                p.innerHTML = `<strong>Submission ${index + 1}:</strong><br>
                    ID: ${sub.id}<br>
                    Title: ${sub.title}<br>
                    Journal: ${sub.journal}<br>
                    Status: ${sub.status}<br>
                    Date: ${UI.formatDate(sub.dateSubmitted)}`;
                output.appendChild(p);
            });
        }
        
        async function createTestSubmission() {
            clearOutput('submissionOutput');
            const session = Storage.getSession();
            
            if (!session) {
                addOutput('submissionOutput', '‚ùå No active session. Login first!', 'error');
                return;
            }
            
            addOutput('submissionOutput', 'Creating test submission...', 'info');
            
            try {
                const testSub = {
                    id: 'SUB-' + Date.now().toString(36).toUpperCase(),
                    userId: session.userId,
                    title: 'Test Manuscript - ' + new Date().toLocaleString(),
                    abstract: 'This is a test abstract for debugging purposes.',
                    keywords: 'test, debug, manuscript',
                    journal: 'Journal of Computer Science',
                    correspondingAuthor: 'Test Author',
                    authorEmail: 'test@example.com',
                    coAuthors: 'Co Author 1, Co Author 2',
                    affiliation: 'Test University',
                    status: 'Under Review',
                    paymentStatus: 'Pending',
                    fileName: 'test-manuscript.pdf',
                    fileSize: 1024000,
                    fileType: 'application/pdf',
                    fileData: null,
                    dateSubmitted: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    deleted: false
                };
                
                Storage.addSubmission(testSub);
                addOutput('submissionOutput', `‚úÖ Test submission created!`, 'success');
                addOutput('submissionOutput', `ID: ${testSub.id}`, 'info');
                addOutput('submissionOutput', `Title: ${testSub.title}`, 'info');
                checkStorage();
            } catch (error) {
                addOutput('submissionOutput', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function clearAllStorage() {
            if (confirm('‚ö†Ô∏è This will delete ALL data. Are you sure?')) {
                localStorage.clear();
                clearOutput('storageOutput');
                addOutput('storageOutput', '‚úÖ All storage cleared', 'success');
            }
        }
        
        function deleteAllSubmissions() {
            if (confirm('‚ö†Ô∏è Delete all submissions? This cannot be undone.')) {
                localStorage.removeItem('cspg_submissions');
                clearOutput('submissionOutput');
                addOutput('submissionOutput', '‚úÖ All submissions deleted', 'success');
            }
        }
        
        function testDashboardRender() {
            clearOutput('dashboardOutput');
            
            if (typeof UserDashboard === 'undefined') {
                addOutput('dashboardOutput', '‚ö†Ô∏è UserDashboard not defined. Dashboard JS not loaded.', 'error');
                return;
            }
            
            addOutput('dashboardOutput', 'UserDashboard module is available', 'success');
            addOutput('dashboardOutput', 'Methods: init, refresh, viewSubmission, closeModal, closeSettingsModal', 'info');
        }
        
        function testRefreshDashboard() {
            clearOutput('dashboardOutput');
            
            if (typeof UserDashboard === 'undefined') {
                addOutput('dashboardOutput', '‚ùå UserDashboard not defined', 'error');
                return;
            }
            
            try {
                UserDashboard.refresh();
                addOutput('dashboardOutput', '‚úÖ Dashboard refreshed', 'success');
            } catch (error) {
                addOutput('dashboardOutput', `‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        // Show initial storage status on page load
        window.addEventListener('load', function() {
            checkStorage();
        });
    </script>
</body>
</html>
